rules_version = '2';

// Firebase Storage Security Rules for Club-X App
service firebase.storage {
  match /b/{bucket}/o {
    
    // Profile images - only authenticated users can upload/delete their own profile image
    match /profile_images/{fileName} {
      allow read: if true; // Anyone can read profile images
      
      // Allow write if authenticated and filename starts with their userId
      allow write: if request.auth != null && 
                     fileName.matches(request.auth.uid + '_[0-9]+\\.jpg') ||
                     fileName == request.auth.uid + '.jpg';
      
      // Allow delete if authenticated and filename starts with their userId
      allow delete: if request.auth != null && 
                      (fileName.matches(request.auth.uid + '_.*') || 
                       fileName.matches(request.auth.uid + '\\.jpg'));
    }
    
    // Club logos - only admins or coordinators can upload
    match /club_logos/{fileName} {
      allow read: if true; // Anyone can read club logos
      allow write: if request.auth != null && 
                     (request.auth.token.role == 'admin' || 
                      request.auth.token.role == 'coordinator');
    }
    
    // Event banners - only admins or coordinators can upload
    match /event_banners/{fileName} {
      allow read: if true;
      allow write: if request.auth != null && 
                     (request.auth.token.role == 'admin' || 
                      request.auth.token.role == 'coordinator');
    }
    
    // Default: deny all other access
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
